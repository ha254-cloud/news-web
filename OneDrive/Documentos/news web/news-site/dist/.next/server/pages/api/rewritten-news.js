"use strict";(()=>{var e={};e.id=388,e.ids=[388],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},9877:(e,t,r)=>{r.r(t),r.d(t,{config:()=>v,default:()=>$,routeModule:()=>I});var i={};r.r(i),r.d(i,{default:()=>A});var a=r(1802),s=r(7153),n=r(6249),l=r(2188),o=r(5017),c=r(2048),u=r.n(c),g=r(5315),d=r.n(g),y=r(4770),p=r.n(y);let h=d().join(process.cwd(),"data"),w=d().join(h,"articles.json");u().existsSync(h)||u().mkdirSync(h,{recursive:!0}),u().existsSync(w)||u().writeFileSync(w,JSON.stringify([],null,2));class m{static generateId(e,t){return p().createHash("md5").update(`${e}-${t}`).digest("hex")}static async getAllArticles(){try{let e=u().readFileSync(w,"utf-8");return JSON.parse(e)}catch(e){return console.error("Error reading articles:",e),[]}}static async getArticleById(e){return(await this.getAllArticles()).find(t=>t.id===e)}static async getArticlesByFilters({country:e,category:t,search:r,page:i=1,limit:a=12}){let s=(await this.getAllArticles()).filter(i=>(!e||i.country===e)&&(!t||i.category===t)&&(!r||!!i.title.toLowerCase().includes(r.toLowerCase())||!!i.aiSummary.toLowerCase().includes(r.toLowerCase())));s.sort((e,t)=>new Date(t.publishedAt)-new Date(e.publishedAt));let n=(i-1)*a;return{articles:s.slice(n,n+a),total:s.length,page:parseInt(i),totalPages:Math.ceil(s.length/a)}}static async saveArticle(e){try{let t=await this.getAllArticles(),r=this.generateId(e.title,e.originalUrl),i=t.findIndex(e=>e.id===r),a={id:r,title:e.title,originalUrl:e.originalUrl,originalDescription:e.originalDescription,aiSummary:e.aiSummary,aiAnalysis:e.aiAnalysis,image:e.image,source:e.source,author:e.author,country:e.country,category:e.category,publishedAt:e.publishedAt,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return i>=0?t[i]={...t[i],...a,updatedAt:new Date().toISOString()}:t.unshift(a),t.length>500&&t.splice(500),u().writeFileSync(w,JSON.stringify(t,null,2)),a}catch(e){throw console.error("Error saving article:",e),e}}static async deleteArticle(e){try{let t=(await this.getAllArticles()).filter(t=>t.id!==e);return u().writeFileSync(w,JSON.stringify(t,null,2)),!0}catch(e){return console.error("Error deleting article:",e),!1}}static async getStats(){let e=await this.getAllArticles(),t={totalArticles:e.length,byCountry:{},byCategory:{},recentArticles:e.slice(0,5).length};return e.forEach(e=>{e.country&&(t.byCountry[e.country]=(t.byCountry[e.country]||0)+1),e.category&&(t.byCategory[e.category]=(t.byCategory[e.category]||0)+1)}),t}}async function A(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{q:r,country:i,category:a,page:s=1,pageSize:n=12,source:l="rewritten"}=e.query;try{if("fresh"===l)return await b(e,t);return await f(e,t)}catch(e){return console.error("News API Error:",e),t.status(500).json({error:"Failed to fetch news",details:e.message})}}async function f(e,t){let{q:r,country:i,category:a,page:s=1,pageSize:n=12}=e.query;try{let e=await m.getArticlesByFilters({country:i,category:a,search:r,page:parseInt(s),limit:parseInt(n)});return t.status(200).json({articles:e.articles.map(e=>({id:e.id,slug:S(e.title,e.id),title:e.title,description:e.aiSummary||e.originalDescription,content:e.aiSummary,image:e.image,image_url:e.image,publishedAt:e.publishedAt,published_at:e.publishedAt,createdAt:e.createdAt,source:e.source,author:e.author,country:e.country,category:e.category,readingTime:Math.ceil((e.aiSummary?.length||0)/200)+" min",isRewritten:!0,url:`/article/${S(e.title,e.id)}`})),pagination:{page:e.page,totalPages:e.totalPages,total:e.total,hasMore:e.page<e.totalPages}})}catch(e){return console.error("Error fetching articles with real images:",e),t.status(500).json({error:"Failed to fetch articles"})}}function S(e,t){e||(e="untitled-article"),t||(t=Date.now().toString());let r=e.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,60);return`${r}-${t}`}async function b(e,t){let r=process.env.NEWS_API_KEY,i=process.env.NEWS_PROVIDER||"newsapi",{q:a,country:s,category:n,page:c=1,pageSize:u=12}=e.query;if(!r)return t.status(500).json({error:"API key not configured. Please add NEWS_API_KEY to your .env.local file."});try{let e,g,d;if("mediastack"===i)e=`http://api.mediastack.com/v1/news?access_key=${r}`,a&&(e+=`&keywords=${encodeURIComponent(a)}`),s&&(e+=`&countries=${s}`),n&&(e+=`&categories=${n}`),e+=`&offset=${(c-1)*u}&limit=${u}`;else{e=`https://newsapi.org/v2/everything?apiKey=${r}`;let t={ke:"Kenya",ng:"Nigeria",za:"South Africa",eg:"Egypt"},i=a;s&&t[s]&&(i=i?`${i} AND ${t[s]}`:t[s]),i&&(e+=`&q=${encodeURIComponent(i)}`),e+=`&language=en&sortBy=publishedAt&page=${c}&pageSize=${u}`,i||s||(e=`https://newsapi.org/v2/top-headlines?apiKey=${r}&country=us`,n&&(e+=`&category=${n}`),e+=`&page=${c}&pageSize=${u}`)}if(g=await fetch(e),d=await g.json(),!g.ok)throw Error(d.message||d.error?.message||"Failed to fetch news");let y=d.articles||d.data||[],p=[];for(let e of y)try{if(!e.title||e.title.length<10)continue;let t=l.HumanNewsRewriter.rewriteArticle(e,s||"global",n||"general");if(!t)continue;let r=await o.t.saveRewrittenArticle(t);p.push({id:r.id,slug:r.slug,title:r.title,description:r.summary,content:r.content,image:r.image,image_url:r.image,publishedAt:r.publishedAt,published_at:r.publishedAt,rewrittenAt:r.rewrittenAt,source:r.originalSource,country:r.country,category:r.category,readingTime:r.readingTime,views:r.views,featured:r.featured,isRewritten:!0,url:`/article/${r.slug}`})}catch(e){console.error("Error processing article:",e)}return t.status(200).json({articles:p,processed:p.length,source:"fresh-rewritten",message:`Successfully rewritten ${p.length} articles`})}catch(e){return console.error("Error fetching and rewriting news:",e),t.status(500).json({error:"Failed to fetch and rewrite news",details:e.message})}}let $=(0,n.l)(i,"default"),v=(0,n.l)(i,"config"),I=new a.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/rewritten-news",pathname:"/api/rewritten-news",bundlePath:"",filename:""},userland:i})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[925],()=>r(9877));module.exports=i})();
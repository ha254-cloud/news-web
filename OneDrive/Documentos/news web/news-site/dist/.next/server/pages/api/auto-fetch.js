"use strict";(()=>{var e={};e.id=747,e.ids=[747],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6890:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>f});var s={};r.r(s),r.d(s,{default:()=>l});var o=r(1802),a=r(7153),i=r(6249),n=r(2188),c=r(5017);async function l(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=process.env.NEWS_API_KEY,s=process.env.NEWS_PROVIDER||"newsapi";if(!r)return t.status(500).json({error:"API key not configured"});try{console.log("Starting automatic news fetch and rewrite...");let e=["business","technology","sports","general"],o=0,a=[];for(let t of["ke","ng","za","eg"])for(let i of e)try{let e=await u(t,i,r,s);o+=e,a.push({country:t,category:i,processed:e}),await new Promise(e=>setTimeout(e,500))}catch(e){console.error(`Error processing ${t}-${i}:`,e),a.push({country:t,category:i,processed:0,error:e.message})}return console.log(`Automatic news fetch completed. Total articles processed: ${o}`),t.status(200).json({success:!0,totalProcessed:o,results:a,message:`Successfully processed ${o} articles across all categories`})}catch(e){return console.error("Error in automatic news fetch:",e),t.status(500).json({error:"Failed to fetch and rewrite news automatically",details:e.message})}}async function u(e,t,r,s){try{let o;if("mediastack"===s)o=`http://api.mediastack.com/v1/news?access_key=${r}`,e&&(o+=`&countries=${e}`),t&&(o+=`&categories=${t}`),o+="&limit=5";else{o=`https://newsapi.org/v2/everything?apiKey=${r}`;let t={ke:"Kenya",ng:"Nigeria",za:"South Africa",eg:"Egypt"}[e]||"Africa";o+=`&q=${encodeURIComponent(t)}&language=en&sortBy=publishedAt&pageSize=5`}let a=await fetch(o),i=await a.json();if(!a.ok)throw Error(i.message||i.error?.message||"Failed to fetch news");let l=i.articles||i.data||[],u=0;for(let r of l)try{if(!r.title||r.title.length<10||(await c.t.getArticlesByFilters({search:r.title.substring(0,30),limit:1})).articles.length>0)continue;let s=n.HumanNewsRewriter.rewriteArticle(r,e,t);if(!s)continue;await c.t.saveRewrittenArticle(s),u++}catch(e){console.error("Error processing individual article:",e);continue}return u}catch(r){return console.error(`Error fetching for ${e}-${t}:`,r),0}}let d=(0,i.l)(s,"default"),p=(0,i.l)(s,"config"),f=new o.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/auto-fetch",pathname:"/api/auto-fetch",bundlePath:"",filename:""},userland:s})}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[925],()=>r(6890));module.exports=s})();
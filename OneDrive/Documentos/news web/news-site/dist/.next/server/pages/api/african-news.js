"use strict";(()=>{var e={};e.id=310,e.ids=[310],e.modules={2167:e=>{e.exports=require("axios")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},855:e=>{e.exports=require("xml2js")},4770:e=>{e.exports=require("crypto")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7218:(e,t,a)=>{a.r(t),a.d(t,{config:()=>u,default:()=>l,routeModule:()=>h});var r={};a.r(r),a.d(r,{default:()=>c});var i=a(1802),s=a(7153),n=a(6249);let{AfricanNewsAggregator:o}=a(5286);async function c(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method)return t.status(200).end();if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{country:a,category:r,search:i,limit:s=50,page:n=1,source:c}=e.query;try{console.log("\uD83D\uDD04 African News API called with params:",{country:a,category:r,search:i,limit:s,page:n,source:c});let e=new o,l=[];l=a?await e.getArticlesByCountry(a):r?await e.getArticlesByCategory(r):i?await e.searchArticles(i):await e.aggregateNews();let u=(parseInt(n)-1)*parseInt(s),h=u+parseInt(s),g=l.slice(u,h).map(e=>({id:e.id,title:e.title||"Untitled",summary:e.description||e.content?.substring(0,200)+"...",image:e.image||null,source:e.source?.name||e.source||"Unknown Source",url:e.url||"#",category:e.category||"General",country:e.country||"Africa",published_at:e.publishedAt||new Date().toISOString(),reading_time:e.readingTime||"2 min read",fetched_at:e.fetchedAt||new Date().toISOString()})),d={success:!0,data:g,meta:{total:l.length,page:parseInt(n),limit:parseInt(s),pages:Math.ceil(l.length/parseInt(s)),fetched_at:new Date().toISOString(),sources:["NewsAPI","MediaStack","AllAfrica RSS","Google News RSS"]},filters:{country:a||null,category:r||null,search:i||null}};console.log(`✅ Returning ${g.length} articles`),t.status(200).json(d)}catch(e){console.error("❌ African News API Error:",e),t.status(500).json({success:!1,error:"Failed to fetch African news",message:e.message,data:[],meta:{total:0,page:parseInt(n),limit:parseInt(s),pages:0,fetched_at:new Date().toISOString()}})}}let l=(0,n.l)(r,"default"),u=(0,n.l)(r,"config"),h=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/african-news",pathname:"/api/african-news",bundlePath:"",filename:""},userland:r})},5286:(e,t,a)=>{let r=a(2167),{MediaStackFetcher:i}=a(6778),{RSSFetcher:s}=a(2711);class n{constructor(){this.mediaStack=new i,this.newsApiKey=process.env.NEWS_API_KEY}async fetchNewsAPI(){if(!this.newsApiKey)return console.log("⚠️ NewsAPI key not found, skipping NewsAPI..."),[];try{console.log("\uD83D\uDD04 Fetching from NewsAPI...");let e=["general","business","technology","sports","health"],t=[];for(let a of["ke","ng","za","gh","eg"])for(let i of e)try{let e=await r.get("https://newsapi.org/v2/top-headlines",{params:{apiKey:this.newsApiKey,country:a,category:i,pageSize:20},timeout:1e4});if(e.data.articles){let r=e.data.articles.map(e=>({title:e.title,description:e.description,content:e.content,url:e.url,image:e.urlToImage,publishedAt:e.publishedAt,source:e.source,country:this.mapCountryCode(a),category:i}));t.push(...r)}await this.delay(100)}catch(e){console.error(`NewsAPI error for ${a}/${i}:`,e.message)}return console.log(`✅ NewsAPI: Fetched ${t.length} articles`),t}catch(e){return console.error("❌ NewsAPI fetch error:",e.message),[]}}async fetchMediaStack(){try{return await this.mediaStack.fetchNews()}catch(e){return console.error("❌ MediaStack fetch error:",e.message),[]}}async fetchRSS(){try{return await s.fetchAllRSS()}catch(e){return console.error("❌ RSS fetch error:",e.message),[]}}async aggregateNews(){console.log("\uD83D\uDE80 Starting African news aggregation...");let e=Date.now(),[t,a,r]=await Promise.all([this.fetchNewsAPI(),this.fetchMediaStack(),this.fetchRSS()]),i=[...t,...a,...r];console.log(`📊 Raw articles fetched: ${i.length}`),i=this.filterAfricanContent(i),console.log(`🌍 African articles after filtering: ${i.length}`),i=this.removeDuplicates(i),console.log(`✨ Unique articles after deduplication: ${i.length}`),i=(i=i.sort((e,t)=>new Date(t.publishedAt)-new Date(e.publishedAt))).map(e=>({...e,id:this.generateId(e.title),fetchedAt:new Date().toISOString(),readingTime:this.estimateReadingTime(e.content||e.description)}));let s=Date.now();return console.log(`✅ Aggregation completed in ${s-e}ms`),console.log(`📰 Final article count: ${i.length}`),i}filterAfricanContent(e){let t=["africa","kenya","nigeria","south africa","ghana","egypt","morocco","ethiopia","tanzania","uganda","rwanda","nairobi","lagos","cape town","accra","cairo","johannesburg","abuja","casablanca","addis ababa"];return e.filter(e=>{if(!e.title&&!e.description)return!1;let a=((e.title||"")+" "+(e.description||"")+" "+(e.country||"")).toLowerCase();return t.some(e=>a.includes(e))})}removeDuplicates(e){let t=new Map;return e.filter(e=>{if(!e.title)return!1;let a=e.title.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim().substring(0,60);return!t.has(a)&&(t.set(a,!0),!0)})}mapCountryCode(e){return({ke:"Kenya",ng:"Nigeria",za:"South Africa",gh:"Ghana",eg:"Egypt",ma:"Morocco",et:"Ethiopia",tz:"Tanzania",ug:"Uganda",rw:"Rwanda"})[e?.toLowerCase()]||"Africa"}generateId(e){return a(4770).createHash("md5").update(e+Date.now()).digest("hex").substring(0,8)}estimateReadingTime(e){if(!e)return"1 min read";let t=e.split(" ").length;return`${Math.ceil(t/200)} min read`}delay(e){return new Promise(t=>setTimeout(t,e))}async getArticlesByCountry(e){return(await this.aggregateNews()).filter(t=>t.country?.toLowerCase()===e.toLowerCase())}async getArticlesByCategory(e){return(await this.aggregateNews()).filter(t=>t.category?.toLowerCase()===e.toLowerCase())}async searchArticles(e){let t=await this.aggregateNews(),a=e.toLowerCase();return t.filter(e=>e.title?.toLowerCase().includes(a)||e.description?.toLowerCase().includes(a))}}e.exports={AfricanNewsAggregator:n}},6778:(e,t,a)=>{let r=a(2167);class i{constructor(){this.apiKey="58b73faaa3a26c528bdbbaf0d9b27e47",this.baseUrl="http://api.mediastack.com/v1/news"}async fetchNews(e={}){let{countries:t="ke,ng,za,gh,eg,ma,et,tz,ug,rw",categories:a="general,business,technology,sports,health",limit:i=100,keywords:s=""}=e;try{console.log("\uD83D\uDD04 Fetching from MediaStack API...");let e={access_key:this.apiKey,countries:t,categories:a,limit:i,sort:"published_desc"};s&&(e.keywords=s);let n=await r.get(this.baseUrl,{params:e,timeout:15e3});if(n.data.error)throw Error(`MediaStack API Error: ${n.data.error.info}`);let o=n.data.data||[];return console.log(`✅ MediaStack: Fetched ${o.length} articles`),o.map(e=>({title:e.title,description:e.description,content:e.description,url:e.url,image:e.image,publishedAt:e.published_at,source:{name:e.source},country:this.mapCountryCode(e.country),category:e.category,language:e.language}))}catch(e){return console.error("❌ MediaStack fetch error:",e.message),[]}}mapCountryCode(e){return({ke:"Kenya",ng:"Nigeria",za:"South Africa",gh:"Ghana",eg:"Egypt",ma:"Morocco",et:"Ethiopia",tz:"Tanzania",ug:"Uganda",rw:"Rwanda"})[e?.toLowerCase()]||"Africa"}async fetchByCategory(e){return this.fetchNews({categories:e})}async fetchByCountry(e){return this.fetchNews({countries:e})}async searchNews(e){return this.fetchNews({keywords:e})}}e.exports={MediaStackFetcher:i}},2711:(e,t,a)=>{let r=a(2167),i=a(855);class s{static async fetchRSS(e,t,a=2){for(let s=1;s<=a;s++)try{console.log(`🔄 Fetching ${t} (attempt ${s}/${a})...`);let{data:n}=await r.get(e,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"},timeout:2e4,maxRedirects:5}),o=await i.parseStringPromise(n),c=[];return o.rss&&o.rss.channel&&o.rss.channel[0].item?c=o.rss.channel[0].item.map(e=>({title:this.extractText(e.title),link:this.extractText(e.link),description:this.extractText(e.description),pubDate:this.extractText(e.pubDate),source:t||this.extractText(o.rss.channel[0].title),image:this.extractImage(this.extractText(e.description)),category:this.extractCategory(e),country:this.extractCountry(this.extractText(e.title)+" "+this.extractText(e.description))})):o.feed&&o.feed.entry&&(c=o.feed.entry.map(e=>({title:this.extractText(e.title),link:e.link&&e.link[0]?e.link[0].$.href:"",description:this.extractText(e.summary||e.content),pubDate:this.extractText(e.published||e.updated),source:t||this.extractText(o.feed.title),image:this.extractImage(this.extractText(e.summary||e.content)),category:this.extractCategory(e),country:this.extractCountry(this.extractText(e.title)+" "+this.extractText(e.summary))}))),console.log(`✅ ${t}: Fetched ${c.length} articles`),c.filter(e=>e.title&&e.link)}catch(r){if(console.error(`❌ Attempt ${s} failed for ${t}:`,r.message),s===a)return console.error(`❌ All ${a} attempts failed for ${t}`),[];let e=2e3*s;console.log(`⏳ Waiting ${e}ms before retry...`),await new Promise(t=>setTimeout(t,e))}return[]}static extractText(e){return e?"string"==typeof e?e:Array.isArray(e)&&e.length>0?"string"==typeof e[0]?e[0]:e[0]._||"":e._||"":""}static extractImage(e){if(!e)return null;for(let t of[/<img[^>]+src="([^"]+)"/i,/<img[^>]+src='([^']+)'/i,/src="([^"]+\.(?:jpg|jpeg|png|gif|webp))"/i,/url\(([^)]+\.(?:jpg|jpeg|png|gif|webp))\)/i]){let a=e.match(t);if(a){let e=a[1];return e.startsWith("//")?e="https:"+e:e.startsWith("/")&&(e="https://allafrica.com"+e),e}}return null}static extractCategory(e){if(e.category){let t=this.extractText(e.category);return this.normalizeCategory(t)}let t=(this.extractText(e.title)+" "+this.extractText(e.description)).toLowerCase();return t.includes("business")||t.includes("economy")||t.includes("finance")?"business":t.includes("sport")||t.includes("football")||t.includes("soccer")?"sports":t.includes("tech")||t.includes("digital")||t.includes("internet")?"technology":t.includes("health")||t.includes("medical")||t.includes("hospital")?"health":t.includes("politic")||t.includes("government")||t.includes("election")?"politics":"general"}static normalizeCategory(e){return({business:"business",economy:"business",finance:"business",sports:"sports",sport:"sports",football:"sports",technology:"technology",tech:"technology",health:"health",politics:"politics",political:"politics",entertainment:"entertainment",science:"science"})[e.toLowerCase()]||"general"}static extractCountry(e){if(!e)return"Africa";let t=e.toLowerCase();for(let[e,a]of Object.entries({Kenya:["kenya","nairobi","kenyan","mombasa"],Nigeria:["nigeria","lagos","abuja","nigerian","kano"],"South Africa":["south africa","cape town","johannesburg","durban","pretoria"],Ghana:["ghana","accra","ghanaian","kumasi"],Egypt:["egypt","cairo","egyptian","alexandria"],Morocco:["morocco","casablanca","rabat","moroccan"],Ethiopia:["ethiopia","addis ababa","ethiopian"],Tanzania:["tanzania","dar es salaam","tanzanian"],Uganda:["uganda","kampala","ugandan"],Rwanda:["rwanda","kigali","rwandan"]}))if(a.some(e=>t.includes(e)))return e;return"Africa"}static async fetchAllAfrica(){let e=[{url:"https://allafrica.com/tools/headlines/rdf/kenya/headlines.rdf",country:"Kenya",fallback:"https://allafrica.com/kenya/"},{url:"https://allafrica.com/tools/headlines/rdf/nigeria/headlines.rdf",country:"Nigeria",fallback:"https://allafrica.com/nigeria/"},{url:"https://allafrica.com/tools/headlines/rdf/ghana/headlines.rdf",country:"Ghana",fallback:"https://allafrica.com/ghana/"},{url:"https://allafrica.com/tools/headlines/rdf/latest/headlines.rdf",country:"Africa",fallback:"https://allafrica.com/latest/"}],t=[];for(let a=0;a<e.length;a+=2){let r=e.slice(a,a+2).map(async e=>{try{let t=await this.fetchRSS(e.url,`AllAfrica ${e.country}`,3);return 0===t.length&&console.log(`⚠️ No articles from ${e.country}, trying fallback approach...`),t.map(t=>({...t,country:"Africa"===t.country?e.country:t.country}))}catch(t){return console.error(`Failed to fetch ${e.country} feed:`,t.message),[]}});(await Promise.all(r)).forEach(e=>t.push(...e)),a+2<e.length&&await new Promise(e=>setTimeout(e,1e3))}return t}static async fetchGoogleNews(){let e=[{query:"Kenya news",country:"Kenya"},{query:"Nigeria news",country:"Nigeria"},{query:"South Africa news",country:"South Africa"},{query:"Ghana news",country:"Ghana"},{query:"Africa breaking news",country:"Africa"}],t=[];for(let a=0;a<e.length;a+=3){let r=e.slice(a,a+3).map(async({query:e,country:t})=>{try{let a=`https://news.google.com/rss/search?q=${encodeURIComponent(e)}&hl=en&gl=US&ceid=US:en`;return(await this.fetchRSS(a,`Google News ${t}`,2)).map(e=>({...e,country:"Africa"===e.country?t:e.country}))}catch(t){return console.error(`Failed to fetch Google News for ${e}:`,t.message),[]}});(await Promise.all(r)).forEach(e=>t.push(...e)),a+3<e.length&&await new Promise(e=>setTimeout(e,500))}return t}static async fetchAllRSS(){console.log("\uD83D\uDD04 Fetching RSS feeds with optimized settings...");let e=Date.now();try{let t=(e,t,a)=>Promise.race([e,new Promise((e,r)=>setTimeout(()=>r(Error(`${a} timed out after ${t}ms`)),t))]),[a,r]=await Promise.allSettled([t(this.fetchAllAfrica(),6e4,"AllAfrica"),t(this.fetchGoogleNews(),3e4,"Google News")]),i="fulfilled"===a.status?a.value:[],s="fulfilled"===r.status?r.value:[];"rejected"===a.status&&console.warn("⚠️ AllAfrica fetch failed:",a.reason.message),"rejected"===r.status&&console.warn("⚠️ Google News fetch failed:",r.reason.message);let n=[...i,...s],o=this.removeDuplicates(n),c=Date.now();return console.log(`✅ RSS fetch completed in ${c-e}ms`),console.log(`✅ Total RSS articles fetched: ${o.length}`),o}catch(e){return console.error("❌ RSS fetch error:",e.message),[]}}static removeDuplicates(e){let t=new Set;return e.filter(e=>{let a=e.title.toLowerCase().replace(/\s+/g,"").substring(0,50);return!t.has(a)&&(t.add(a),!0)})}}e.exports={RSSFetcher:s}},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=7218);module.exports=a})();